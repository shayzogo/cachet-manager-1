# cachet-manager

 * PHP script to Manage Updates on the Cachet Status Page by Hammed Olalekan Osanyinpeju aka Successtar

 * The script serve as an agent to update status of components on cachet status page when the host is inactive and when it is active

 * To get the best out of this script, take note of the following

	* The script assume all your components are grouped into three categories which are Websites with group id = 1, API's with group id = 2 and Services with group id = 3

	* All Components are checked if it is alive or down with necessary update made on cachet status page based on the result obtain from the script

	* Response Time and Uptime metrics are auto-generated by the script for all components in the API and Sevices group. Therefore, metrics are not expected to be created from the cachet dashboard for consistency.

	* To make the script functional, you need to set a cron job that will execute the script at one minute interval for uptimum performance of the script. The cron job looks like this,
 
	  &nbsp; * * * * *      /usr/bin/php -q -f /path/to/update.php &>/dev/null

	or

   	  &nbsp; * * * * *     /usr/local/bin/php -q -f /path/to/update.php &>/dev/null

	depending on your host configuration

	* Once the script is up and running, go to your cachet dashboard and modify the metrics generated by the script by changing the value of "Calculation of metrics" to "average" and the value of "How many minutes of threshold between metric points?" to "1"

	* With this, be rest assured of positive response from the script.

	POINT TO NOTE

		The script check host availabilty using a ping command using exec() function which might not be allowed for some share hosting due to security reasons. Verify if your host allow the function by running the script below;

	<?php

	 exec("ping -c 1 google.com", $out);

	if ($out){
  		echo "exec() command is allowed on this host. Nothing to worry about.";
	}
	?>

	If you get "exec() command is allowed on this host. Nothing to worry about." as response without any error after running the php code above, the script should work perfectly for you.

	If you get error message or warning it means you will have to modify the script before it can work for you.

	Go to the script, change 	

		public function pingUrl($url){
			//Filter url leaving the host name for pinging 
	 		$url = str_replace("https://", "", str_replace("http://", "", str_replace("www.", "", $url)));
			$url_host = explode("/", $url);
			//Ping the host name and set the time before and after pinging to measure load time
			$startTime = microtime(true) * 1000;
			exec("ping -c 1  ".$url_host[0], $out);
			$stopTime = microtime(true) * 1000;
			//If pinging is successful return the time taken for the transaction else return false
			if ($out){
  				return ($stopTime - $startTime);
			}else{
  				return false;
			}
		}


	TO

		public function pingUrl($url){
			// Check Url if it is live
			$ch = curl_init($url);
			curl_setopt($ch, CURLOPT_RETURNTRANSFER,1);
    		curl_exec($ch);
   			$info = curl_getinfo($ch);

			//Check the link if active or not. Return false if the link is down else return load time if link is active
   			if ($info["http_code"] === 0){
  				return false;
			}else{
  				return $info["total_time"];
			}
		}

	This will still work but only for url that can be accessed via https or http and lower little performance compare to when ping is used.

	
*	Finally, if you follow the guide properly, the script should work for you. Suggestion, correction and critics are highly welcome.

*	For further enquiries, you can reach me on 2347061855688 or osanyinpejuhammed35@gmail.com.

*	Thanks... 

 
